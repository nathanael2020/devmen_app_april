<div data-hook="search_results">
  <% if @products.empty? %>
  <h6 class="search-results-title"><%= t(:no_products_found) %></h6>
  <% else %>
    <% if @products.supplement.exists? %>
    <% @supplment_products = @products.supplement.sort_by(&:id) %>
    <% @ingredients_table = Spree::Product.ingredients_table(@supplment_products) %>
    <h6 class="search-results-title"><%= t(:search_results_ingredients,  :keywords => h(params[:keywords])) %></h6>

    <table class='table-search-result-ingredients table'>
      <tr>
        <th>Ingredient</th>
        <% @supplment_products.each do |product| %>
        <th><%= product.name %></th>
        <% end %>
      </tr>

        <% @ingredients_table.each do |ingredient, items| %>
        <tr>
        <td> <%= ingredient.name %></td>
        <% @supplment_products.each do |product| %>
          <td>
            <% if current_product = items.detect{|j| product.id == j.product_id} %>
            <% @current_item = current_product.product.amount_ingredient(ingredient)  %>
            <%= @current_item %>
            <%= ingredient.unit %>
            <% end %>
          </td>

        <% end %>
        </tr>
        <% end %>

    </table>
    <% else %>
    <%= render :partial => 'spree/shared/products', :locals => { :products => @products, :taxon => @taxon } %>
    <% end %>
  <% end %>
</div>
